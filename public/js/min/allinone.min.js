function previewDatasetData(){var site_url=$("#site-url").data("site_url"),data=serializeSearchDatasetForm();$.ajax({type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(data),url:site_url+"/datasetExplorer/searchDatasetData",success:function(response){$(".main-container .content").html(response)}})}function downloadDatasetData(file_extension){var site_url=$("#site-url").data("site_url"),data=serializeSearchDatasetForm();data.action="download",data.file_extension=file_extension,$.ajax({type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(data),dataType:"json",url:site_url+"/datasetExplorer/searchDatasetData",success:function(response){window.open(site_url+"/datasetExplorer/downloadDatasetFile?file="+response.file,"_blank")}})}function serializeSearchDatasetForm(){var data=($("#data-consult-form"),{collection:$("#collection").val(),fields:[],selected_fields:[]}),element=null;return $(".field-filters-js").each(function(){var filters=[];$(this).find(":input").each(function(){filters.push({name:$(this).attr("name"),value:$(this).val()})}),element={field:$(this).data("field"),type:$(this).data("data_type"),filters:filters},data.fields.push(element)}),data.selected_fields=getFieldsForDisplay(),data}function getFieldsForDisplay(){var selected_fields=[],parent=null;return $(".fields-select-js .selector-js:checked").each(function(){parent=$(this).closest(".option-js"),selected_fields.push({field:parent.data("field"),description:parent.data("description")})}),selected_fields}function previewDatasetData(){var site_url=$("#site-url").data("site_url"),data=serializeSearchDatasetForm();data.context=$(".datasets-container-js").data("context"),$.ajax({type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(data),url:site_url+"/datasetExplorer/searchDatasetData",success:function(response){$(".main-container .content").html(response)}})}function downloadDatasetData(file_extension){var site_url=$("#site-url").data("site_url"),data=serializeSearchDatasetForm();data.action="download",data.file_extension=file_extension,$.ajax({type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(data),dataType:"json",url:site_url+"/datasetExplorer/searchDatasetData",success:function(response){window.open(site_url+"/datasetExplorer/downloadDatasetFile?file="+response.file,"_blank")}})}function serializeSearchDatasetForm(){var data=($("#data-consult-form"),{collection:$("#collection").val(),fields:[],selected_fields:[]}),element=null;return $(".field-filters-js").each(function(){var filters=[];$(this).find(":input").each(function(){filters.push({name:$(this).attr("name"),value:$(this).val()})}),element={field:$(this).data("field"),type:$(this).data("data_type"),filters:filters},data.fields.push(element)}),data.selected_fields=getFieldsForDisplay(),data.group_by=$(".field-group-js .group-by-js").val(),data.num_rows=$(".field-num-results-js .num-results-js").val(),data}function getFieldsForDisplay(){var selected_fields=[],parent=null;return $(".fields-select-js .selector-js:checked").each(function(){parent=$(this).closest(".option-js"),selected_fields.push({field:parent.data("field"),description:parent.data("description")})}),selected_fields}function moreResults(){var site_url=$("#site-url").data("site_url"),data=serializeSearchDatasetForm(),element=$(".main-container .content .list-records-js"),page=element.data("page");data.page=page,element.data("page",++page),$.ajax({type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(data),url:site_url+"/datasetExplorer/searchDatasetData",success:function(response){$(".main-container .content .list-records-js tbody").append(response)}})}function buildGraph(records){var datasets=[],label=null,labels=[];jQuery.each(records[0],function(key,val){var data=[];if(labels=[],jQuery.each(records,function(index,item){jQuery.each(item,function(sub_key,sub_val){if(sub_key==key&&"tmstp"!=key&&"Pavg"!=key&&"Qavg"!=key&&"Vavg"!=key){if(null==sub_val)sub_val=0;else if("number"!=typeof sub_val)return;data.push(sub_val)}}),labels.push(item.tmstp)}),0!=data.length){var color=getRandomColor(),json={label:label,fillColor:color.alpha(.6).toRgbaString(),strokeColor:color.alpha(1).toRgbaString(),pointColor:color.alpha(.2).toRgbaString(),pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:data};datasets.push(json)}});var data={labels:labels,datasets:datasets},ctx=document.getElementById("myChart").getContext("2d");new Chart(ctx).Line(data)}function getRandomColor(){var hue=12*Math.floor(30*Math.random());return $.Color({hue:hue,saturation:.3,lightness:.6,alpha:.5})}function login(){var site_url=$("#site-url").data("site_url");if($(".auth-container .sign-in-container-js").is(":visible")){var form=$("#login-form");$.post(site_url+"/login",form.serialize(),function(response){void 0!=response.errors?displayErrors(response.errors):window.location=site_url+"/datasetExplorer"},"json")}else $(".sign-in-container-js").slideDown("medium"),$(".sign-up-container-js").slideUp("medium")}function signUp(){var site_url=$("#site-url").data("site_url");$(".auth-container .sign-up-container-js").is(":visible")?validateSignUpForm()&&$.post(site_url+"/saveUser",$("#sign-up-form").serialize(),function(response){"success"==response.success?(successMessages(["You've signed up successufully! Please login."]),login()):"undefined"!==response.errors&&displayErrors(response.errors)},"json"):($(".sign-up-container-js").slideDown("medium"),$(".sign-in-container-js").slideUp("medium"))}function validateSignUpForm(){var form=$("#sign-up-form"),errors=[];return(""==form.find("#first-name").val()||""==form.find("#last-name").val())&&errors.push("Full name required"),""==form.find("#email").val()?errors.push("Email required"):form.find("#email").val()!=form.find("#email-confirm").val()&&errors.push("Email and email confirmation doesn't match"),""==form.find("#password").val()?errors.push("Password required"):form.find("#password").val()!=form.find("#password-confirm").val()&&errors.push("Password and password confirmation doesn't match"),errors.length>0?(displayErrors(errors),!1):!0}function displayErrors(errors){for(var html="",i=0;i<errors.length;i++)html+="<p>"+errors[i]+"</p>";$("#errors-container-js").html(html),$("#errors-container-js").dialog("open")}function successMessages(messages){for(var html="",i=0;i<messages.length;i++)html+="<p>"+messages[i]+"</p>";$("#success-messages-js").html(html),$("#success-messages-js").dialog("open")}function newActivityLog(activity_id,obs){var site_url=$("#site-url").data("site_url");$.ajax({url:site_url+"/activityLog/new",data:{activity_id:activity_id,obs:obs},global:!1,type:"POST"})}$(function(){!function(i,s,o,g,r,a,m){i.GoogleAnalyticsObject=r,i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date,a=s.createElement(o),m=s.getElementsByTagName(o)[0],a.async=1,a.src=g,m.parentNode.insertBefore(a,m)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-50665694-4","auto"),ga("send","pageview"),"undefined"!=typeof jQuery&&jQuery(document).ready(function($){var filetypes=/\.(zip|exe|dmg|pdf|doc.*|xls.*|ppt.*|mp3|txt|rar|wma|mov|avi|wmv|flv|wav)$/i,baseHref="";void 0!=jQuery("base").attr("href")&&(baseHref=jQuery("base").attr("href")),jQuery("a").on("click",function(event){var el=jQuery(this),track=!0,href="undefined"!=typeof el.attr("href")?el.attr("href"):"",isThisDomain=href.match(document.domain.split(".").reverse()[1]+"."+document.domain.split(".").reverse()[0]);if(!href.match(/^javascript:/i)){var elEv=[];if(elEv.value=0,elEv.non_i=!1,href.match(/^mailto\:/i))elEv.category="email",elEv.action="click",elEv.label=href.replace(/^mailto\:/i,""),elEv.loc=href;else if(href.match(filetypes)){var extension=/[.]/.exec(href)?/[^.]+$/.exec(href):void 0;elEv.category="download",elEv.action="click-"+extension[0],elEv.label=href.replace(/ /g,"-"),elEv.loc=baseHref+href}else href.match(/^https?\:/i)&&!isThisDomain?(elEv.category="external",elEv.action="click",elEv.label=href.replace(/^https?\:\/\//i,""),elEv.non_i=!0,elEv.loc=href):href.match(/^tel\:/i)?(elEv.category="telephone",elEv.action="click",elEv.label=href.replace(/^tel\:/i,""),elEv.loc=href):track=!1;if(track&&(ga.push(["_trackEvent",elEv.category.toLowerCase(),elEv.action.toLowerCase(),elEv.label.toLowerCase(),elEv.value,elEv.non_i]),void 0==el.attr("target")||"_blank"!=el.attr("target").toLowerCase()))return setTimeout(function(){location.href=elEv.loc},400),!1}})})}),$(function(){var site_url=$("#site-url").data("site_url");$("#data-consult-form-dialog-js").dialog({title:"Data Consult",modal:!0,autoOpen:!1,width:800,resizable:!1,minHeight:350,position:["middle",50],open:function(){$(this).css("maxHeight",500)},buttons:{Submit:function(){previewDatasetData(),$(this).dialog("close")}}}),$(".datasets-picker-js li a").on("click",function(){$(".datasets-picker-js li a").each(function(){$(this).removeClass("active")}),$(this).addClass("active");var element=$(".datasets-picker-js li .active").closest("li");$("#data-consult-form-dialog-js").load(site_url+"/datasetExplorer/queryData",{dataset:element.data("option")},function(response){newActivityLog(3,"Data consult on "+element.data("option")+" dataset"),previewDatasetData()})})}),$(document).on("click",".operation-opts .filter-js",function(){$("#data-consult-form-dialog-js").dialog("open")}),$(document).on("click",".operation-opts .download-js",function(){newActivityLog(4,"Data consult on "+element.data("option")+" dataset"),downloadDatasetData("js")}),$(document).on("click",".operation-opts .download-csv",function(){newActivityLog(5,"Data consult on "+element.data("option")+" dataset"),downloadDatasetData("csv")}),$(document).on("click",".fields-select-js .option-js .option-title",function(){var site_url=$("#site-url").data("site_url"),parent=$(this).closest(".option-js");$(this).toggleClass("selected");var status=!0;if($(".filters-container-js .field-filters-js").each(function(){$(this).data("field")==parent.data("field")&&($(this).remove(),status=!1)}),0==$(".filters-container-js .field-filters-js").length&&$(".filters-container-js .title").hide(),status){var data={field:parent.data("field"),type:parent.data("type"),description:parent.data("description")};$.post(site_url+"/datasetExplorer/addFilter",data,function(response){$(".filters-container-js").append(response),$(".filters-container-js .title").show()})}}),$(document).on("change","#data-consult-form .fields-container .main-selector-js",function(){var checked=$(".main-selector-js").is(":checked");$(".fields-select-js .selector-js").each(function(){$(this).prop("checked",checked)})}),$(function(){var site_url=$("#site-url").data("site_url");$("#data-consult-form-dialog-js").dialog({title:"Customize your data",modal:!0,autoOpen:!1,width:800,resizable:!1,minHeight:350,position:["middle",50],open:function(){$(this).css("maxHeight",500)},buttons:{Submit:function(){previewDatasetData()}}}),$(".datasets-picker-js li a").on("click",function(){$(".datasets-picker-js li a").each(function(){$(this).removeClass("active")}),$(".list-records-js").data("page","0"),$(this).addClass("active");var element=$(".datasets-picker-js li .active").closest("li");$("#data-consult-form-dialog-js").load(site_url+"/datasetExplorer/queryData",{dataset:element.data("option")},function(response){newActivityLog(3,"Data consult on "+element.data("option")+" dataset"),previewDatasetData()})})}),$(document).on("click",".operation-opts .filter-js",function(){$("#data-consult-form-dialog-js").dialog("open")}),$(document).on("click",".operation-opts .download-js",function(){downloadDatasetData("js")}),$(document).on("click",".operation-opts .download-csv-js",function(){downloadDatasetData("csv")}),$(document).on("click",".operation-opts .chart-js",function(){$(".datasets-container-js").data("context","chart"),previewDatasetData()}),$(document).on("click",".operation-opts .listing-js",function(){$(".datasets-container-js").data("context","listing"),previewDatasetData()}),$(document).on("click",".fields-select-js .option-js .option-title",function(){var site_url=$("#site-url").data("site_url"),parent=$(this).closest(".option-js");$(this).toggleClass("selected");var status=!0;if($(".filters-container-js .field-filters-js").each(function(){$(this).data("field")==parent.data("field")&&($(this).remove(),status=!1)}),0==$(".filters-container-js .field-filters-js").length&&$(".filters-container-js .title").hide(),status){var data={field:parent.data("field"),type:parent.data("type"),description:parent.data("description")};$.post(site_url+"/datasetExplorer/addFilter",data,function(response){$(".filters-container-js").append(response),$(".filters-container-js .title").show()})}}),$(document).on("change","#data-consult-form .fields-container .main-selector-js",function(){var checked=$(".main-selector-js").is(":checked");$(".fields-select-js .selector-js").each(function(){$(this).prop("checked",checked)})}),$(function(){$("#site-url").data("site_url");$(".auth-container .sign-up-btn-js").on("click",function(event){signUp()}),$(".auth-container .log-in-btn-js").on("click",function(event){login()}),$("#login-form").on("submit",function(event){event.preventDefault(),login()}),$("#sign-up-form").on("submit",function(event){event.preventDefault(),signUp()})});var site_url=$("#site-url").data("site_url");$(function(){var site_url=$("#site-url").data("site_url");$("#errors-container-js").dialog({title:"Error",modal:!0,autoOpen:!1,width:600}),$("#success-messages-js").dialog({title:"Success",modal:!0,autoOpen:!1,width:600}),$.blockUI.defaults.message=$("#slider"),$.blockUI.defaults.css.border="0px",$.blockUI.defaults.overlayCSS.opacity="0.1",$(document).ajaxStart(function(){$.blockUI(),$("#slider").show()}),$(document).ajaxStop(function(){$.unblockUI(),$("#slider").hide()});var opts={lines:10,length:40,width:3,radius:20,corners:.8,rotate:0,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e3,top:25},target=document.getElementById("slider");new Spinner(opts).spin(target);$(".horizontal-nav .log-out-js").on("click",function(){$.get(site_url+"/user/logout",function(){window.location=site_url+"/index"})})});